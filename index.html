<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>板金現場報工系統</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="wrap">
        <section class="header">
            <div class="header-machine"><p class="header-text">機台：折床-3120</p></div>
            <div class="header-query"><a href="repo.html">報工查詢</a></div>
            <div class="header-signout"><a href="#">登出</a></div>
        </section>
        <section class="Scan">
            <input type="text" id="Scaninput"  class="Scan-input" placeholder="請掃描工單條碼">
        </section>
        <section class="main">
            <div class="main-order">
                <h2 class="order-title">工單資訊</h2>
                <p class="order-text">製令單號：<span id="orderNoText">-</span></p>
                <p class="order-text">品名：<span id="itemNameText">-</span></p>
                <p class="order-text">品號：<span id="itemNoText">-</span></p>
            </div>
            <div class="boder"></div>
            <form action="index.html" method="get" class="main-return" id="reportform">
                <h2 class="return-title">報工回報</h2>
                <p class="return-text">作業人員：王小華-00123</p>
                <p class="return-text" >完成數量：<input type="number" name="goodnumber" id="goodNumber"></p>
                <p class="return-text" >不良數量：<input type="number" name="badnumber" id="badNumber"></p>
                <button type="submit" class="return-btn">送出</button>
            </form>
        </section>
    </div>

    <script>
        
        const form = document.getElementById("reportform") //定義reportform = form
        form.addEventListener("submit", function(a){  //監聽submit事件
            a.preventDefault(); //阻止表單預設行為
            const report = {
            orderNo: document.getElementById("orderNoText").textContent,
            itemName: document.getElementById("itemNameText").textContent,
            itemNo: document.getElementById("itemNoText").textContent,
            operator: "王小華-00123",
            goodNumber: document.getElementById("goodNumber").value,
            badNumber: document.getElementById("badNumber").value,
            time: new Date().toLocaleString()};
            //將報工資料存入localStorage
            let reports = JSON.parse(localStorage.getItem("reports")) || [];//取得現有報工資料，若無則為空陣列
            reports.push(report);//加入新報工資料
            localStorage.setItem("reports", JSON.stringify(reports));//存回localStorage
            form.reset(); //重設表單
        })  
        // 模擬工單資料庫data
         const orders = {
                            "5102-202600001": { orderNo:"5102-202600001", itemName:"機箱", itemNo:"12345678", orderQty:"100" },
                            "5102-202600002": { orderNo:"5102-202600002", itemName:"機箱蓋", itemNo:"87654321", orderQty:"80" },
                        };
        //抓到掃碼輸入框
        const Scaninput  = document.getElementById("Scaninput");//掃描輸入框
        //監聽輸入框的按鍵事件
        Scaninput.addEventListener("keydown", function(e){ //監聽按鍵事件
         if(e.key === "Enter"){ //如果按下的是Enter鍵
            e.preventDefault(); //阻止預設行為（避免換行）
            const code = Scaninput.value.trim();   // 掃到的製令單號
            const o = orders[code];                // 去假資料庫找

            if(!o){ // 如果找不到工單
            alert("查無此工單：" + code); //跳出警告視窗
            return; //結束函式
            }

            // 更新左邊四格
            document.getElementById("orderNoText").textContent  = o.orderNo; //更新製令單號
            document.getElementById("itemNameText").textContent = o.itemName; //更新品名
            document.getElementById("itemNoText").textContent   = o.itemNo; //更新品號

            // 也順便存起來（等下送 repo 會用）
            localStorage.setItem("orderNo", o.orderNo);
            localStorage.setItem("itemName", o.itemName);
            localStorage.setItem("itemNo", o.itemNo);
                    }
                    });

    </script>
</body>
</html>